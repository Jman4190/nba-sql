(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{3351:function(t,o,i){"use strict";function n(t,o,i,r,s,a){if(!(s-r<=i)){var u=Math.floor((r+s)/2);!function t(o,i,n,r,s,a){for(;s>r;){if(s-r>600){var u=s-r+1,h=n-r+1,p=Math.log(u),d=.5*Math.exp(2*p/3),l=.5*Math.sqrt(p*d*(u-d)/u)*(h-u/2<0?-1:1),m=Math.max(r,Math.floor(n-h*d/u+l)),c=Math.min(s,Math.floor(n+(u-h)*d/u+l));t(o,i,n,m,c,a)}var f=i[2*n+a],g=r,v=s;for(e(o,i,r,n),i[2*s+a]>f&&e(o,i,r,s);g<v;){for(e(o,i,g,v),g++,v--;i[2*g+a]<f;)g++;for(;i[2*v+a]>f;)v--}i[2*r+a]===f?e(o,i,r,v):(v++,e(o,i,v,s)),v<=n&&(r=v+1),n<=v&&(s=v-1)}}(t,o,u,r,s,a%2),n(t,o,i,r,u-1,a+1),n(t,o,i,u+1,s,a+1)}}function e(t,o,i,n){r(t,i,n),r(o,2*i,2*n),r(o,2*i+1,2*n+1)}function r(t,o,i){var n=t[o];t[o]=t[i],t[i]=n}function s(t,o,i,n){var e=t-i,r=o-n;return e*e+r*r}function a(t,o,i,n,e){return new u(t,o,i,n,e)}function u(t,o,i,e,r){o=o||h,i=i||p,r=r||Array,this.nodeSize=e||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var s=0;s<t.length;s++)this.ids[s]=s,this.coords[2*s]=o(t[s]),this.coords[2*s+1]=i(t[s]);n(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function h(t){return t[0]}function p(t){return t[1]}function d(t){this.options=v(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function l(t,o,i,n,e){return{x:t,y:o,zoom:1/0,id:i,parentId:-1,numPoints:n,properties:e}}function m(t){return{type:"Feature",id:t.id,properties:c(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(o=t.y,i=(180-360*o)*Math.PI/180,360*Math.atan(Math.exp(i))/Math.PI-90)]}};var o,i,n}function c(t){var o=t.numPoints,i=o>=1e4?Math.round(o/1e3)+"k":o>=1e3?Math.round(o/100)/10+"k":o;return v(v({},t.properties),{cluster:!0,cluster_id:t.id,point_count:o,point_count_abbreviated:i})}function f(t){return t/360+.5}function g(t){var o=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+o)/(1-o))/Math.PI;return i<0?0:i>1?1:i}function v(t,o){for(var i in o)t[i]=o[i];return t}function x(t){return t.x}function M(t){return t.y}i.r(o),i.d(o,"default",(function(){return y})),u.prototype={range:function(t,o,i,n){return function(t,o,i,n,e,r,s){for(var a,u,h=[0,t.length-1,0],p=[];h.length;){var d=h.pop(),l=h.pop(),m=h.pop();if(l-m<=s)for(var c=m;c<=l;c++)a=o[2*c],u=o[2*c+1],a>=i&&a<=e&&u>=n&&u<=r&&p.push(t[c]);else{var f=Math.floor((m+l)/2);a=o[2*f],u=o[2*f+1],a>=i&&a<=e&&u>=n&&u<=r&&p.push(t[f]);var g=(d+1)%2;(0===d?i<=a:n<=u)&&(h.push(m),h.push(f-1),h.push(g)),(0===d?e>=a:r>=u)&&(h.push(f+1),h.push(l),h.push(g))}}return p}(this.ids,this.coords,t,o,i,n,this.nodeSize)},within:function(t,o,i){return function(t,o,i,n,e,r){for(var a=[0,t.length-1,0],u=[],h=e*e;a.length;){var p=a.pop(),d=a.pop(),l=a.pop();if(d-l<=r)for(var m=l;m<=d;m++)s(o[2*m],o[2*m+1],i,n)<=h&&u.push(t[m]);else{var c=Math.floor((l+d)/2),f=o[2*c],g=o[2*c+1];s(f,g,i,n)<=h&&u.push(t[c]);var v=(p+1)%2;(0===p?i-e<=f:n-e<=g)&&(a.push(l),a.push(c-1),a.push(v)),(0===p?i+e>=f:n+e>=g)&&(a.push(c+1),a.push(d),a.push(v))}}return u}(this.ids,this.coords,t,o,i,this.nodeSize)}},d.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,initial:function(){return{}},map:function(t){return t}},load:function(t){var o=this.options.log;o&&console.time("total time");var i="prepare "+t.length+" points";o&&console.time(i),this.points=t;for(var n,e,r,s=[],u=0;u<t.length;u++)t[u].geometry&&s.push((n=t[u],e=u,r=void 0,{x:f((r=n.geometry.coordinates)[0]),y:g(r[1]),zoom:1/0,index:e,parentId:-1}));this.trees[this.options.maxZoom+1]=a(s,x,M,this.options.nodeSize,Float32Array),o&&console.timeEnd(i);for(var h=this.options.maxZoom;h>=this.options.minZoom;h--){var p=+Date.now();s=this._cluster(s,h),this.trees[h]=a(s,x,M,this.options.nodeSize,Float32Array),o&&console.log("z%d: %d clusters in %dms",h,s.length,+Date.now()-p)}return o&&console.timeEnd("total time"),this},getClusters:function(t,o){var i=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),e=180===t[2]?180:((t[2]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)i=-180,e=180;else if(i>e){var s=this.getClusters([i,n,180,r],o),a=this.getClusters([-180,n,e,r],o);return s.concat(a)}for(var u=this.trees[this._limitZoom(o)],h=u.range(f(i),g(r),f(e),g(n)),p=[],d=0;d<h.length;d++){var l=u.points[h[d]];p.push(l.numPoints?m(l):this.points[l.index])}return p},getChildren:function(t){var o=t>>5,i=t%32,n="No cluster with the specified id.",e=this.trees[i];if(!e)throw new Error(n);var r=e.points[o];if(!r)throw new Error(n);for(var s=this.options.radius/(this.options.extent*Math.pow(2,i-1)),a=e.within(r.x,r.y,s),u=[],h=0;h<a.length;h++){var p=e.points[a[h]];p.parentId===t&&u.push(p.numPoints?m(p):this.points[p.index])}if(0===u.length)throw new Error(n);return u},getLeaves:function(t,o,i){o=o||10,i=i||0;var n=[];return this._appendLeaves(n,t,o,i,0),n},getTile:function(t,o,i){var n=this.trees[this._limitZoom(t)],e=Math.pow(2,t),r=this.options.extent,s=this.options.radius/r,a=(i-s)/e,u=(i+1+s)/e,h={features:[]};return this._addTileFeatures(n.range((o-s)/e,a,(o+1+s)/e,u),n.points,o,i,e,h),0===o&&this._addTileFeatures(n.range(1-s/e,a,1,u),n.points,e,i,e,h),o===e-1&&this._addTileFeatures(n.range(0,a,s/e,u),n.points,-1,i,e,h),h.features.length?h:null},getClusterExpansionZoom:function(t){for(var o=t%32-1;o<this.options.maxZoom;){var i=this.getChildren(t);if(o++,1!==i.length)break;t=i[0].properties.cluster_id}return o},_appendLeaves:function(t,o,i,n,e){for(var r=this.getChildren(o),s=0;s<r.length;s++){var a=r[s].properties;if(a&&a.cluster?e+a.point_count<=n?e+=a.point_count:e=this._appendLeaves(t,a.cluster_id,i,n,e):e<n?e++:t.push(r[s]),t.length===i)break}return e},_addTileFeatures:function(t,o,i,n,e,r){for(var s=0;s<t.length;s++){var a=o[t[s]],u={type:1,geometry:[[Math.round(this.options.extent*(a.x*e-i)),Math.round(this.options.extent*(a.y*e-n))]],tags:a.numPoints?c(a):this.points[a.index].properties},h=a.numPoints?a.id:this.points[a.index].id;void 0!==h&&(u.id=h),r.features.push(u)}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,o){for(var i=[],n=this.options.radius/(this.options.extent*Math.pow(2,o)),e=0;e<t.length;e++){var r=t[e];if(!(r.zoom<=o)){r.zoom=o;var s=this.trees[o+1],a=s.within(r.x,r.y,n),u=r.numPoints||1,h=r.x*u,p=r.y*u,d=null;this.options.reduce&&(d=this.options.initial(),this._accumulate(d,r));for(var m=(e<<5)+(o+1),c=0;c<a.length;c++){var f=s.points[a[c]];if(!(f.zoom<=o)){f.zoom=o;var g=f.numPoints||1;h+=f.x*g,p+=f.y*g,u+=g,f.parentId=m,this.options.reduce&&this._accumulate(d,f)}}1===u?i.push(r):(r.parentId=m,i.push(l(h/u,p/u,m,u,d)))}}return i},_accumulate:function(t,o){var i=o.numPoints?o.properties:this.options.map(this.points[o.index].properties);this.options.reduce(t,i)}};var w=i(3324);const _=()=>{};function y(t){const{width:o,height:i,formData:n,hooks:e,queryData:r}=t,{onError:s=_,setControlValue:a=_}=e,{bounds:u,geoJSON:h,hasCustomMetric:p,mapboxApiKey:l}=r.data,{clusteringRadius:m,globalOpacity:c,mapboxColor:f,mapboxStyle:g,pandasAggfunc:v,pointRadius:x,pointRadiusUnit:M,renderWhileDragging:y}=n,b=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/.exec(f);if(null===b)return s("Color field must be of form 'rgb(%d, %d, %d)'"),{};const z={maxZoom:w.DEFAULT_MAX_ZOOM,radius:m};p&&(z.initial=()=>({sum:0,squaredSum:0,min:1/0,max:-1/0}),z.map=t=>({sum:t.metric,squaredSum:t.metric**2,min:t.metric,max:t.metric}),z.reduce=(t,o)=>{t.sum+=o.sum,t.squaredSum+=o.squaredSum,t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max)});const P=new d(z);return P.load(h.features),{width:o,height:i,aggregatorName:v,bounds:u,clusterer:P,globalOpacity:c,hasCustomMetric:p,mapboxApiKey:l,mapStyle:g,onViewportChange(t){let{latitude:o,longitude:i,zoom:n}=t;a("viewport_longitude",i),a("viewport_latitude",o),a("viewport_zoom",n)},pointRadius:"Auto"===x?w.DEFAULT_POINT_RADIUS:x,pointRadiusUnit:M,renderWhileDragging:y,rgb:b}}}}]);